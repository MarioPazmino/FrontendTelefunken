<!-- game-table.component.html -->
<div class="game-container" *ngIf="!isLoading && !error">
  <!-- Cabecera de la partida -->
  <div class="game-header">
    <h2>Código de sala: {{ gameCode }}</h2>
    <div class="round-info">
      Ronda actual: {{ gameState.rounds[gameState.currentRound]?.name || 'N/A' }}
      <span *ngIf="gameState.status === 'ended'"> (Finalizada)</span>
    </div>
  </div>

  <!-- Lista de jugadores -->
  <div class="players-list">
    <div class="player"
         *ngFor="let player of players"
         [ngClass]="{ 'current-turn': player.username === currentTurn }">
      <div class="player-name">
        {{ player.username }}
        <span *ngIf="player.username === authService.getUsername()"> (Tú)</span>
      </div>
      <div class="tokens">
        Fichas restantes: {{ 12 - (gameState.tokensUsed?.[player.username] || 0) }}
      </div>
    </div>
  </div>

  <!-- Panel de acciones -->
  <div class="action-panel" *ngIf="gameState.status === 'in_progress'">
    <div *ngIf="isMyTurn" class="current-turn-alert">
      ¡Es tu turno!
    </div>

    <!-- Reclamar ronda -->
    <div class="action-section" *ngIf="!roundClaimed">
      <h3>Reclamar Ronda</h3>
      <input type="number"
             [(ngModel)]="claimedTokenCount"
             min="1"
             [max]="remainingTokens"
             placeholder="Fichas a usar">
      <button (click)="claimRound()"
              [disabled]="claimedTokenCount < 1 || claimedTokenCount > remainingTokens">
        Reclamar
      </button>
    </div>

    <!-- Validar/Rechazar -->
    <div class="action-section" *ngIf="roundClaimed && isMyTurn">
      <h3>Validar Ronda</h3>
      <button (click)="approveRound(true)">Aprobar</button>
      <button (click)="approveRound(false)">Rechazar</button>
    </div>

    <!-- Declarar cartas -->
    <div class="action-section" *ngIf="isMyTurn">
      <h3>Declarar Cartas</h3>
      <div *ngFor="let card of ['2','3','4','5','6','7','8','9','10','J','Q','K','A','Joker']">
        <label>
          {{ card }}:
          <input type="number"
                 [(ngModel)]="currentDeclarations[card]"
                 min="0"
                 max="12">
        </label>
      </div>
      <button (click)="declareCards()">Enviar Declaración</button>
    </div>
  </div>

  <!-- Historial de rondas -->
  <div class="round-history">
    <h3>Historial de Rondas</h3>
    <table>
      <tr *ngFor="let round of roundHistory">
        <td>{{ round.name }}</td>
        <td>Ganador: {{ round.winner || 'N/A' }}</td>
        <td>Puntos: {{ round.points | json }}</td>
      </tr>
    </table>
  </div>

  <!-- Resultado final -->
  <div class="game-result" *ngIf="gameState.status === 'ended'">
    <h2>¡Partida Finalizada!</h2>
    <div>Ganador: {{ winner }}</div>
    <div>Detalles:</div>
    <pre>{{ gameState.results | json }}</pre>
  </div>

  <!-- Botón de abandonar -->
  <button class="leave-button" (click)="leaveGameTable()">Abandonar Partida</button>
</div>

<!-- Estados de carga y error -->
<div *ngIf="isLoading" class="loading">Cargando partida...</div>
<div *ngIf="error" class="error">{{ error }}</div>
